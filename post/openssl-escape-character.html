<!DOCTYPE html><html lang="zh-TW"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><script>!function(){try {var d=document.documentElement.classList;d.remove('light','dark');var e=localStorage.getItem('theme');if("system"===e||(!e&&true)){var t="(prefers-color-scheme: dark)",m=window.matchMedia(t);m.media!==t||m.matches?d.add('dark'):d.add('light')}else if(e) d.add(e)}catch(e){}}()</script><title>Openssl escape character | s8508235&#x27;s blog</title><meta name="description" content="Be careful about the escape character as Linux input"/><meta property="og:type" content="website"/><meta name="og:title" property="og:title" content="Openssl escape character"/><meta name="og:description" property="og:description" content="Be careful about the escape character as Linux input"/><link rel="icon" type="image/png" href="/blog/favicon.ico"/><link rel="apple-touch-icon" href="/blog/favicon.ico"/><meta name="next-head-count" content="10"/><link rel="preload" href="/_next/static/css/4fc286d84d344085.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4fc286d84d344085.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-5752944655d749a0.js" defer=""></script><script src="/_next/static/chunks/framework-24fda4117f092221.js" defer=""></script><script src="/_next/static/chunks/main-eea31613c344d1ea.js" defer=""></script><script src="/_next/static/chunks/pages/_app-492e99d0a17aabe9.js" defer=""></script><script src="/_next/static/chunks/827-22efc97fb31500a7.js" defer=""></script><script src="/_next/static/chunks/716-a52d3c0d45b6ee73.js" defer=""></script><script src="/_next/static/chunks/552-14dffc3b36c9d95b.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-8fb7f12603d96f88.js" defer=""></script><script src="/_next/static/5rHCI8A1s62P7WZFUzuaq/_buildManifest.js" defer=""></script><script src="/_next/static/5rHCI8A1s62P7WZFUzuaq/_ssgManifest.js" defer=""></script><script src="/_next/static/5rHCI8A1s62P7WZFUzuaq/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="w-full min-h-screen dark:bg-gray-700 dark:text-white"><div class="max-w-screen-sm px-4 py-12 mx-auto antialiased font-body"><header class="flex items-center justify-between  mb-2"><div class="max-w-md"><h1><a class="text-2xl font-black text-blue-800 no-underline font-display dark:text-blue-400" href="/">Minimal blog</a></h1></div></header><main><article><header class="mb-8"><h1 class="mb-2 text-5xl font-black leading-none font-display">Openssl escape character</h1><p class="text-sm">January 8, 2022</p></header><div class="mb-4 prose lg:prose-lg dark:prose-dark"><p>First of all, I pick <a target="_blank" rel="noopener noreferrer" href="https://datatracker.ietf.org/doc/html/draft-cavage-http-signatures-12">HTTP signature</a> as my authorization method.</p><p>I use <a target="_blank" rel="noopener noreferrer" href="https://github.com/tsenart/vegeta">Vegeta</a> to load test my API service.</p><p>When writing a script for target generation, I need to make a signature for each request.</p><p>So I used <code>openssl</code> to generate it.</p><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>echo -n &quot;${message}&quot; | openssl dgst -sha256 -hmac &quot;${secret}&quot; -binary | base64</span></code></pre><p>But I did not pass my authenticator.</p><p>After some trying(use other language to reproduce what happened), I found that message used for generation was weird.(check the byte)</p><p>Go:</p><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-go" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#8be9fd">import</span><span> </span><span class="token" style="color:#f8f8f2">(</span><span>
</span><span>	</span><span class="token" style="color:#50fa7b">&quot;crypto/hmac&quot;</span><span>
</span><span>	</span><span class="token" style="color:#50fa7b">&quot;crypto/sha256&quot;</span><span>
</span><span>	b64 </span><span class="token" style="color:#50fa7b">&quot;encoding/base64&quot;</span><span>
</span><span></span><span class="token" style="color:#f8f8f2">)</span><span>
</span><span></span><span class="token" style="color:#6272a4">// https://go.dev/play/p/JaDyZh_wNqn</span><span>
</span><span></span><span class="token" style="color:#8be9fd">func</span><span> </span><span class="token" style="color:#f1fa8c">hmacSha256</span><span class="token" style="color:#f8f8f2">(</span><span>data </span><span class="token" style="color:#50fa7b">string</span><span class="token" style="color:#f8f8f2">,</span><span> secret </span><span class="token" style="color:#50fa7b">string</span><span class="token" style="color:#f8f8f2">)</span><span> </span><span class="token" style="color:#50fa7b">string</span><span> </span><span class="token" style="color:#f8f8f2">{</span><span>
</span><span>	h </span><span class="token" style="color:#f8f8f2">:=</span><span> hmac</span><span class="token" style="color:#f8f8f2">.</span><span class="token" style="color:#f1fa8c">New</span><span class="token" style="color:#f8f8f2">(</span><span>sha256</span><span class="token" style="color:#f8f8f2">.</span><span>New</span><span class="token" style="color:#f8f8f2">,</span><span> </span><span class="token" style="color:#f8f8f2">[</span><span class="token" style="color:#f8f8f2">]</span><span class="token" style="color:#f1fa8c">byte</span><span class="token" style="color:#f8f8f2">(</span><span>secret</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">)</span><span>
</span><span>	h</span><span class="token" style="color:#f8f8f2">.</span><span class="token" style="color:#f1fa8c">Write</span><span class="token" style="color:#f8f8f2">(</span><span class="token" style="color:#f8f8f2">[</span><span class="token" style="color:#f8f8f2">]</span><span class="token" style="color:#f1fa8c">byte</span><span class="token" style="color:#f8f8f2">(</span><span>data</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">)</span><span>
</span><span>	</span><span class="token" style="color:#8be9fd">return</span><span> b64</span><span class="token" style="color:#f8f8f2">.</span><span>URLEncoding</span><span class="token" style="color:#f8f8f2">.</span><span class="token" style="color:#f1fa8c">EncodeToString</span><span class="token" style="color:#f8f8f2">(</span><span>h</span><span class="token" style="color:#f8f8f2">.</span><span class="token" style="color:#f1fa8c">Sum</span><span class="token" style="color:#f8f8f2">(</span><span class="token" style="color:#bd93f9">nil</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">)</span><span>
</span><span></span><span class="token" style="color:#f8f8f2">}</span></code></pre><p>Node:</p><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-javascript" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#8be9fd">var</span><span> crypto </span><span class="token" style="color:#f8f8f2">=</span><span> </span><span class="token" style="color:#f1fa8c">require</span><span class="token" style="color:#f8f8f2">(</span><span class="token" style="color:#50fa7b">&#x27;crypto&#x27;</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">;</span><span>
</span><span></span><span class="token" style="color:#8be9fd">function</span><span> </span><span class="token" style="color:#f1fa8c">hmacSha256</span><span class="token" style="color:#f8f8f2">(</span><span class="token parameter">message</span><span class="token parameter" style="color:#f8f8f2">,</span><span class="token parameter"> secret</span><span class="token" style="color:#f8f8f2">)</span><span> </span><span class="token" style="color:#f8f8f2">{</span><span>
</span><span>    hmac </span><span class="token" style="color:#f8f8f2">=</span><span> crypto</span><span class="token" style="color:#f8f8f2">.</span><span class="token method property-access" style="color:#f1fa8c">createHmac</span><span class="token" style="color:#f8f8f2">(</span><span class="token" style="color:#50fa7b">&#x27;sha256&#x27;</span><span class="token" style="color:#f8f8f2">,</span><span> secret</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">;</span><span>
</span><span>    hmac</span><span class="token" style="color:#f8f8f2">.</span><span class="token method property-access" style="color:#f1fa8c">update</span><span class="token" style="color:#f8f8f2">(</span><span>message</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">;</span><span>
</span><span>    </span><span class="token control-flow" style="color:#8be9fd">return</span><span> hmac</span><span class="token" style="color:#f8f8f2">.</span><span class="token method property-access" style="color:#f1fa8c">digest</span><span class="token" style="color:#f8f8f2">(</span><span class="token" style="color:#50fa7b">&#x27;base64&#x27;</span><span class="token" style="color:#f8f8f2">)</span><span>
</span><span></span><span class="token" style="color:#f8f8f2">}</span></code></pre><p>When make <code>a\nmessage</code> as argument in Linux, it would be the same as <code>a\\nmessage</code>.</p><p>Use</p><pre style="color:#f8f8f2;background:#282a36;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>echo -e -n &quot;${message}&quot; | openssl dgst -sha256 -hmac &quot;${secret}&quot; -binary | base64</span></code></pre><p>instead.</p><p>This was why my target generation script didn&#x27;t pass the authenticator.</p><p>I had definitely known how the escape character works, but I didn&#x27;t check it in the first place.</p><p>When using escape character as Linux input, you should be careful about it.</p><p>Openssl might be a misplace but never mind. I found the problem from it.</p><p>Just write a note to remember the time wasted on it.</p></div><hr class="mt-4"/><footer><div class="flex items-center space-x-3 mt-8 mb-16"><div class="flex-shrink-0 mb-0 overflow-hidden rounded-full w-14 h-14"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2756%27%20height=%2756%27/%3e"/></span><img alt="Profile" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;filter:blur(20px);background-size:cover;background-image:url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAHCAAAAAAQMlOCAAAASklEQVR42gE/AMD/AG/Q1dbUplpPAKD/7eHs1QBBAKD85tivzKBnAIbs7eDW3/ClAIvJyODi3ue9ACmwueTk4ejCACBf19TX1N6z530ojUkGi+cAAAAASUVORK5CYII=&quot;);background-position:0% 0%"/><noscript><img alt="Profile" srcSet="https://s8508235.github.io/blog/_next/static/media/profile.7ee99ab4.png?auto=format&amp;fit=max&amp;w=64 1x, https://s8508235.github.io/blog/_next/static/media/profile.7ee99ab4.png?auto=format&amp;fit=max&amp;w=128 2x" src="https://s8508235.github.io/blog/_next/static/media/profile.7ee99ab4.png?auto=format&amp;fit=max&amp;w=128" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div><p class="text-base leading-7">Written by<!-- --> <a class="font-semibold" target="_blank" rel="noreferrer noopener" href="https://github.com/s8508235">s8508235</a> <b>[ZH-TW/EN]</b><br/>Before being good at writing, I have to start writing.<!-- --> </p></div></footer></article><nav class="flex flex-wrap justify-between mb-10"><a class="text-lg font-bold" href="/post/cache-policy">← <!-- -->An introduction to Window TinyLFU</a><div></div></nav></main><footer class="text-lg font-light">© <!-- -->2022<!-- --> If you have any questions, please send me <a href="mailto:a8508235@gmail.com">an email</a>!</footer></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontmatter":{"title":"Openssl escape character","date":"January 8, 2022","description":"Be careful about the escape character as Linux input"},"post":{"content":" \nFirst of all, I pick [HTTP signature](https://datatracker.ietf.org/doc/html/draft-cavage-http-signatures-12) as my authorization method.\n\nI use [Vegeta](https://github.com/tsenart/vegeta) to load test my API service.\n\nWhen writing a script for target generation, I need to make a signature for each request.\n\nSo I used `openssl` to generate it.\n```\necho -n \"${message}\" | openssl dgst -sha256 -hmac \"${secret}\" -binary | base64\n```\nBut I did not pass my authenticator.\n\nAfter some trying(use other language to reproduce what happened), I found that message used for generation was weird.(check the byte)\n\nGo:\n```go\nimport (\n\t\"crypto/hmac\"\n\t\"crypto/sha256\"\n\tb64 \"encoding/base64\"\n)\n// https://go.dev/play/p/JaDyZh_wNqn\nfunc hmacSha256(data string, secret string) string {\n\th := hmac.New(sha256.New, []byte(secret))\n\th.Write([]byte(data))\n\treturn b64.URLEncoding.EncodeToString(h.Sum(nil))\n}\n```\n\nNode:\n```javascript\nvar crypto = require('crypto');\nfunction hmacSha256(message, secret) {\n    hmac = crypto.createHmac('sha256', secret);\n    hmac.update(message);\n    return hmac.digest('base64')\n}\n```\n\nWhen make `a\\nmessage` as argument in Linux, it would be the same as `a\\\\nmessage`.\n\nUse \n```\necho -e -n \"${message}\" | openssl dgst -sha256 -hmac \"${secret}\" -binary | base64\n``` \ninstead.\n\nThis was why my target generation script didn't pass the authenticator.\n\nI had definitely known how the escape character works, but I didn't check it in the first place.\n\nWhen using escape character as Linux input, you should be careful about it.\n\nOpenssl might be a misplace but never mind. I found the problem from it.\n\nJust write a note to remember the time wasted on it.","excerpt":""},"previousPost":{"slug":"cache-policy","frontmatter":{"title":"An introduction to Window TinyLFU","date":"April 27, 2021","description":"TinyLFU is a frequency-based cache admission policy"},"excerpt":"","content":" \n## Foreword\nI will just easily go through techniques used by Window TinyLFU.\n\n## Why Cache?\nBecause we want to access data fast. The buffering provided by a cache benefits both latency and throughput.\n\n## Eviction Policies\n- Since we cannot cache all data we have, we need to discard some cache when out of space\n- We should consider what the cost is if we choose the policy\n- Eviction decisions should be done in an efficient manner, in order to avoid a situation in which the computation and space overheads required to answer these questions surpasses the benefit of using the cache\n- Hit rate, latency \u0026 space matter\n\n#### Examples\n- Least recently used (LRU): Discards the least recently used items first\n- Least frequently used (LFU): Discards data that was least frequently used\n- Segment LRU (SLRU):\n  - SLRU cache is divided into two segments, a probationary segment and a\nprotected segment\n  - Lines in each segment are ordered from the most to the least recently\naccessed\n  - Data from misses is added to the cache at the most recently accessed end of\nthe probationary segment\n  - Hits are removed from wherever they currently reside and added to the most\nrecently accessed end of the protected segment\n  - Lines in the protected segment have thus been accessed at least twice\n\n## Probability data structure\n\n#### Examples\n- Bloom Filter\n  - Pairwise independent hash functions\n  - Used to test whether an element is a member of a set\n  - Two result: \"possibly in set\" or \"definitely not in set\"\n  - isInSet(input) = (h1(input) and h2(input) and h3(input) ...)\n- Count-min Sketch\n  - Pairwise independent hash functions\n  - Used to count elements\n  - count(input) = min(h1(input), h2(input), h3(input), ...)\n\n## Admission policy\n- Hope to boost the effectiveness of caches\n- Given a newly accessed item and an eviction candidate from the cache, our\nscheme decides, based on the recent access history, whether it is worth\nadmitting the new item into the cache at the expense of the eviction candidate\n- An accessed item is only inserted into the cache if an admission policy\ndecides that the cache hit ratio is likely to benefit from replacing it with the\ncache victim\n\n### TinyLFU\nTinyLFU admission policy use Bloom Filter and Count-min Sketch to trace state of elements.\n![TinyLFU structure](cache-policy-pics/tinylfu.png)\n\nIf there is a new element insert event that makes the main cache(SLRU) discard its element, they will be compared with the\nstate of TinyLFU admission policy (Bloom Filter and Count-min Sketch).\n![TinyLFU with Main Cache](cache-policy-pics/tinylfu-2.png)\n\nFinally, for sparse bursts, the paper suggest a LRU as window cache.\n![W-TinyLFU](cache-policy-pics/w-tinylfu.png)\n\n## Reference\n- [Cache(wikipedia)](https://en.wikipedia.org/wiki/Cache_(computing))\n- [Cache replacement policies](https://en.wikipedia.org/wiki/Cache_replacement_policies)\n- [Caffeine wiki](https://github.com/ben-manes/caffeine/wiki/Efficiency)\n- [Window TinyLFU paper](https://dl.acm.org/doi/10.1145/3149371)"},"nextPost":null},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"openssl-escape-character"},"buildId":"5rHCI8A1s62P7WZFUzuaq","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>